{% extends "::base.html.twig" %}

{% block title %}Home | VisualMasters{% endblock title %}

{% block stylesheets %}
    {{ parent() }}

    {% stylesheets
        "bundles/site/css/landing.css"
        "bundles/site/css/cookieconsent.min.css"
        filter="yui_css, cssrewrite" %}
        <link href="{{ asset_url }}" type="text/css" rel="stylesheet" />
    {% endstylesheets %}
{% endblock stylesheets %}

{% block content %}
    {{ include('SiteBundle:default/sections:header.html.twig') }}

    {{ include('SiteBundle:default/sections:main.html.twig') }}

    {{ include('SiteBundle:default/sections:about.html.twig') }}

    {{ include('SiteBundle:default/sections:services.html.twig') }}

    {{ include('SiteBundle:default/sections:descriptions.html.twig') }}

    {{ include('SiteBundle:default/sections:portfolio.html.twig') }}

    {{ include('SiteBundle:default/sections:media.html.twig') }}

    {{ include('SiteBundle:default/sections:contact.html.twig') }}

    {{ include('SiteBundle:default/sections:order.modal.html.twig') }}

{% endblock content %}

{% block javascripts %}
    {{ parent() }}

    {% javascripts
        "bundles/site/js/creative.js"
        "bundles/site/js/cookieconsent.min.js"
        "bundles/site/js/index.js"
        filter="yui_js" %}
        <script src="{{ asset_url }}" type="text/javascript"></script>
    {% endjavascripts %}

    <script type="text/javascript">
        var RC2KEY = '{{ google_recaptcha_site_key }}', doSubmit = false;

        function reCaptchaVerify(response) {
            if (response === document.querySelector('.g-recaptcha-response').value) {
                doSubmit = true;
            }
        }

        function reCaptchaExpired() {
            /* do something when it expires */
        }

        function reCaptchaCallback() {
            /* this must be in the global scope for google to get access */
            grecaptcha.render('rc2-input', {
                'sitekey':          RC2KEY,
                'callback':         reCaptchaVerify,
                'expired-callback': reCaptchaExpired
            });
        }

        (function () {
            $("#order-form form").on('submit', function (e) {
                if (doSubmit) {
                    $.ajax({
                        type:        'POST',
                        url:         "{{ path('process_order') }}",
                        data:        new FormData(this),
                        processData: false,
                        contentType: false,
                        success:     function (response) {
                            if (response.status == 'ok') {
                                $("#order-form").toggleClass('hidden');
                                $("#order-success-note").toggleClass('hidden');
                            }
                        }
                    });
                }
                return false;
            });
        })();
    </script>
{% endblock javascripts %}